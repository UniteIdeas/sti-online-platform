{% load static %}
<div class="filter">
    <form id="search" method="POST" data-currentpage={{ filters.page }}>{% csrf_token %}
    <div class="container">
        <div>
            <input type="hidden" name="partners" />
            <input type="hidden" name="language" />
            <input type="hidden" name="type" {% if filters.type %}value={{ filters.type }}{% endif %}/>
            {% if not hidesearch %}
            <div class="col-xs-12 col-sm-6 col-md-7 col-lg-8 filter-detail">
                <div class="input-group">
                    {% if not hidelogo %}
                    <span class="input-group-addon" style="background-color:inherit; border:none; padding:0; padding-right:12px;">
                        <img width="27px" height="27px" src="{% static '/images/TFM_logo.png' %}" />
                    </span>
                    {% endif %}
                    <input name="query" class="form-control" type="text" value="{{ filters.query }}"/>
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="submit">Search</button>
                    </span>
                </div>
            </div>
            {% endif %}
            {% if not hidesearch %}
            <ul class="col-xs-12 col-sm-6 col-md-5 col-lg-4 filter-detail nav nav-pills">
            {% else %}
            <ul class="col-xs-12 filter-detail nav nav-pills">
            {% endif %}
                {% if not hidepartners %}
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="#">
                        Sources
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu padded-menu">
                        <li>
                            <input class="filter-partner" type="checkbox" id="apctt" {% if filters.partners == None or filters.partners == 'all' or filters.partners.apctt == True %}checked{% endif %}/>
                            <label for="apctt"><img class="partner-logo" src="{% static 'images/apctt-logo.png' %}" /></label>
                        </li>
                        <li>
                            <input class="filter-partner" type="checkbox" id="cittc" {% if filters.partners == None or filters.partners == 'all' or filters.partners.cittc == True %}checked{% endif %}/>
                            <label for="cittc"><img class="partner-logo" src="{% static 'images/cittc-logo.png' %}" /></label>
                        </li>
                        <li>
                            <input class="filter-partner" type="checkbox" id="unido" {% if filters.partners == None or filters.partners == 'all' or filters.partners.unido == True %}checked{% endif %}/>
                            <label for="unido"><img class="partner-logo" src="{% static 'images/unido-logo.png' %}" /></label>
                        </li>
                        <li>
                            <input class="filter-partner" type="checkbox" id="wipogreen" {% if filters.partners == None or filters.partners == 'all' or filters.partners.wipogreen == True %}checked{% endif %}/>
                            <label for="wipogreen"><img class="partner-logo" src="{% static 'images/wipo-green-logo.png' %}" /></label>
                        </li>
                        <li>
                            <input class="filter-partner" type="checkbox" id="een" {% if filters.partners == None or filters.partners == 'all' or filters.partners.een == True %}checked{% endif %}/>
                            <label for="een"><img class="partner-logo" src="{% static 'images/een-logo.png' %}" /></label>
                        </li>
                        <li>
                            <input class="filter-partner" type="checkbox" id="unfccc" {% if filters.partners == None or filters.partners == 'all' or filters.partners.unfccc == True %}checked{% endif %}/>
                            <label for="unfccc"><img class="partner-logo" src="{% static 'images/unfccc-logo.png' %}" /></label>
                        </li>
                        <li>
                            <input class="filter-partner" type="checkbox" id="unossc" {% if filters.partners == None or filters.partners == 'all' or filters.partners.unossc == True %}checked{% endif %}/>
                            <label for="unossc"><img class="partner-logo" src="{% static 'images/unossc-logo.png' %}" /></label>
                        </li>
                        <li>
                            <input class="filter-partner" type="checkbox" id="openaire" {% if filters.partners == None or filters.partners == 'all' or filters.partners.openaire == True %}checked{% endif %}/>
                            <label for="openaire"><img class="partner-logo" src="{% static 'images/openaire-logo.png' %}" /></label>
                        </li>
                    </ul>
                </li>
                {% endif %}
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="#">
                        Language
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu language-menu">
                        <li><input type="radio" name="filter-language" id="any" {% if filters.language == None or filters.language == 'any' %}checked{% endif %}/><label for="any">Any language</label></li>
                        <li role="separator" class="divider"></li>
                        <li><input type="radio" name="filter-language" id="english" {% if filters.language == 'english' %}checked{% endif %}/><label for="english">English</label></li>
                        <li><input type="radio" name="filter-language" id="french" {% if filters.language == 'french' %}checked{% endif %}/><label for="french">French</label></li>
                        <li><input type="radio" name="filter-language" id="german" {% if filters.language == 'german' %}checked{% endif %}/><label for="german">German</label></li>
                        <li><input type="radio" name="filter-language" id="spanish" {% if filters.language == 'spanish' %}checked{% endif %}/><label for="spanish">Spanish</label></li>
                        <li><input type="radio" name="filter-language" id="russian" {% if filters.language == 'russian' %}checked{% endif %}/><label for="russian">Russian</label></li>
                        <li><input type="radio" name="filter-language" id="danish" {% if filters.language == 'danish' %}checked{% endif %}/><label for="danish">Danish</label></li>
                        <li><input type="radio" name="filter-language" id="dutch" {% if filters.language == 'dutch' %}checked{% endif %}/><label for="dutch">Dutch</label></li>
                        <li><input type="radio" name="filter-language" id="finnish" {% if filters.language == 'finnish' %}checked{% endif %}/><label for="finnish">Finnish</label></li>
                        <li><input type="radio" name="filter-language" id="hungarian" {% if filters.language == 'hungarian' %}checked{% endif %}/><label for="hungarian">Hungarian</label></li>
                        <li><input type="radio" name="filter-language" id="italian" {% if filters.language == 'italian' %}checked{% endif %}/><label for="italian">Italian</label></li>
                        <li><input type="radio" name="filter-language" id="norwegian" {% if filters.language == 'norwegian' %}checked{% endif %}/><label for="norwegian">Norwegian</label></li>
                        <li><input type="radio" name="filter-language" id="portuguese" {% if filters.language == 'portuguese' %}checked{% endif %}/><label for="portuguese">Portuguese</label></li>
                        <li><input type="radio" name="filter-language" id="romanian" {% if filters.language == 'romanian' %}checked{% endif %}/><label for="romanian">Romanian</label></li>
                        <li><input type="radio" name="filter-language" id="swedish" {% if filters.language == 'swedish' %}checked{% endif %}/><label for="swedish">Swedish</label></li>
                        <li><input type="radio" name="filter-language" id="turkish" {% if filters.language == 'turkish' %}checked{% endif %}/><label for="turkish">Turkish</label></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" rol="button" aria-haspopup="true" aria-expanded="false" href="#">
                        Location
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu padded-menu">
                        <li>
                            <div class="input-group">
                            <input type="text" class="form-control"/>
                            <div class="input-group-btn">
                                <button class="btn btn-info">Go</button>
                            </div>
                        </li>
                    </ul>
                </li>
                {% if hidesearch %}
                <li>
                    <button id="searchButtonOutline" class="btn btn-link" type="submit">Search</button>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
    </form>
    <script>
    $('#search').on('submit', function(event) {
        var query = $('#filter-query').val();
        var partners = {};
        var allPartners = true;
        var partnerSelections = $('.filter-partner');
        for (var i=0; i<partnerSelections.length; i++) {
            if (partnerSelections[i].checked) {
                partners[partnerSelections[i].id] = true;
            }
            else {
                allPartners = false;
            }
        }
        if (!allPartners) {
            $('[name="partners"]').val(JSON.stringify(partners));
        }
        if ($('[name="filter-language"]:checked')[0].id !== 'any') {
            $('[name="language"]').val($('[name="filter-language"]:checked')[0].id);
        }
    });
    </script>
</div>
<div class="results">
    <div class="container">
        <div class="col-xs-12">
        {% for row in results %}
            {% include "sti/search-result.html" with row=row %}
        {% endfor %}
        {% if results|length == 0 %}
            <div style="padding:53px 0; font-weight:bold;">
            No results found
            </div>
        {% endif %}
        {% if hasprev or hasnext %}
        <nav>
            <ul class="pager">
                {% if hasprev %}
                <li class="previous"><a href="#" data-nav="prev">&larr; Previous</a></li>
                {% endif %}{%if hasnext %}
                <li class="next"><a href="#" data-nav="next">Next &rarr;</a></li>
                {%endif%}
            </ul>
        </nav>
        <script>
        $('.pager li a').on('click', function(event) {
            var currentPage = Number($('#search').data('currentpage'));
            if ($(event.target).data('nav') == 'prev') {
                currentPage -= 1;
            }
            else {
                currentPage += 1;
            }
            $('#search').append('<input type="hidden" name="page" value="' + currentPage + '" />');
            $('#search').trigger('submit');
            event.preventDefault();
        });
        </script>
        {% endif %}
        </div>
    </div>
</div>
